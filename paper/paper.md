---
title: 'ERF: Energy Research and Forecasting'

tags:
  - C++
  - atmospheric modeling
  - mesoscale
  - wind energy

authors:
  - name: Ann Almgren
    orcid: 0000-0003-2103-312X
    corresponding: true
    affiliation: 1
  - name: Aaron Lattanzi
    orcid: 0000-0002-3372-406X
    affiliation: 1
  - name: Riyaz Haque
    orcid: 0000-0001-8930-5721
    affiliation: 4
  - name: Pankaj Jha
    orcid: 0000-0003-1476-6747
    affiliation: 4
  - name: Branko Kosovic
    orcid: 0000-0002-1746-0746
    affiliation: 6
  - name: Jeffrey Mirocha
    orcid: 0000-0001-5914-6168
    affiliation: 4
  - name: Bruce Perry
    orcid: 0000-0002-9150-8103
    affiliation: 2
  - name: Eliot Quon
    orcid: 0000-0002-8445-5840
    affiliation: 2
  - name: Michael Sanders
    orcid: 0000-0001-6644-2571
    affiliation: 5
  - name: David Wiersema
    orcid: 0000-0001-8452-4095
    affiliation: 4
  - name: Donald Willcox
    orcid: 0000-0003-2300-5165
    affiliation: 1
  - name: Xingqiu Yuan
    orcid: 0000-0002-6146-1260
    affiliation: 3
  - name: Weiqun Zhang
    orcid: 0000-0001-8092-1974
    affiliation: 1

affiliations:
 - name: Lawrence Berkeley National Laboratory
   index: 1
 - name: National Renewable Energy Laboratory
   index: 2
 - name: Argonne National Laboratory
   index: 3
 - name: Lawrence Livermore National Laboratory
   index: 4
 - name: San Diego State University
   index: 5
 - name: National Center for Atmospheric Research
   index: 6

date: 17 February 2023

bibliography: paper.bib
---

# Summary

The Energy Research and Forecasting (ERF) code is a new model that simulates the mesoscale and microscale
dynamics of the atmosphere using the latest high-performance computing architectures.  It employs
hierarchical parallelism using an MPI+X model, where X may be OpenMP on multicore CPU-only systems,
or CUDA, HIP or SYCL on GPU-accelerated systems.  ERF is designed to provide a flexible 
computational framework for the exploration and investigation of different physics parameterizations 
and numerical strategies, and to provide a characterization of the flow field that impacts the 
ability of wind turbines to extract wind energy.  The ERF development is part of a broader effort 
led by the US Department of Energy's Wind Energy Technologies Office (WETO).
ERF is built on AMReX, a block-structured adaptive mesh refinement software framework which 
provides the underlying performance-portable software infrastructure for block-structured mesh operations. 

ERF solves the fully-compressible Navier-Stokes equations for
dry or moist air.  Microphysics options in ERF include a warm non-precipitating model
that evolves cloud water and cloud vapor, as well as a single-moment model that 
additionally allows for cloud ice, rain, hail, graupel and snow.  
Two Large Eddy Simulation (LES) models -- Smagorinsky and Deardorff -- as well as a
MYNN Level 2.5 Planetary Boundary Layer (PBL) scheme - are available as run-time potions.

The spatial discretization in ERF uses the classic Arakawa C-grid with 
scalar quantities at cell centers and normal velocities at cell faces.  
Users have the option to supply non-constant topography at the bottom 
boundary of the domain; the mesh is then deformed to fit the terrain,
using height (rather than pressure) coordinates.  Map scale factors
can be included as well.  The advection
terms can be calculated using second through sixth-order accurate
spatial discretizations, including both centered difference and upwind 
schemes.  Third- and fifth-order WENO advection schemes are also
available for the cell-centered scalars.

The time discretization in ERF utilizes a third-order Runge-Kutta scheme with 
substepping of perturbational quantities at the acoustic time scale. 
(A non-substepping method is also available as a run-time option.)

ERF supports both static and dynamics (adaptive) mesh refinement,
with subcycling in time at finer levels of refinement.

Physical forcings include Coriolis and geostrophic forcing, as well as 
Rayleigh damping in the upper regions of the domain.  Lateral boundary
conditions can be specified as periodic, inflow/outflow, or the values
can be supplied as time-varying data read in from external files 
in netcdf format generated by the WRF Preprocessing System (WPS).   
The initial data can be read from  WPS-generated files; 
reconstructed from 1-d input sounding data; or specified by the user.

# Statement of need

Most widely used atmospheric modeling codes today do not have the 
ability to use GPU acceleration, which limits their ability to 
efficiently utilize current and next-generation high performance computing 
architectures.  ERF provides an atmospheric modeling capability, with 
many of the standard discretizations and basic features needed for simulation of 
flows relevant to wind energy, that runs on the latest high-performance 
computing architectures, from laptops to supercomputers, 
whether CPU-only or GPU-accelerated.
In addition, ERF is based on a modern, well-supported AMR library (AMReX),
which provides a performance portable interface that shields ERF
from most of the detailed changes needed to adapt to new systems.
The active and large developer community contributing to AMReX helps ensure
that ERF will continue to run efficiently as architectures and operating systems
evolve.

# Acknowledgements

Funding for this work was provided by the U.S. Department of Energy
Office of Energy Efficiency and Renewable Energy Wind Energy Technologies Office.
We acknowledge as well as the help of the AMReX team
in developing and supporting new AMReX features needed by ERF.
The work at LBNL was supported by the U.S. Department of Energy
under contract No. DE-AC02-05CH11231.

# References
